# System Architecture Diagram

## High-Level Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        YOUR WATER LEVEL SYSTEM                  â”‚
â”‚                      (Complete Integration)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 1: SENSOR (Hardware)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Arduino ESP32   â”‚
â”‚  + HC-SR04       â”‚
â”‚  Ultrasonic      â”‚ â—„â”€â”€â”€ Measures distance (cm)
â”‚  Sensor          â”‚ â—„â”€â”€â”€ Calculates water level (mm)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ (every 5 sec)
         â”‚ JSON payload:
         â”‚ {waterLevel: 34.77, distance: 15.23, timestamp: ...}
         â–¼

LAYER 2: DATABASE (Cloud)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Firebase Realtime Database     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /water_level/sensor1             â”‚ â—„â”€â”€â”€ Latest: 34.77 mm
â”‚   {waterLevel: 34.77, ...}       â”‚
â”‚                                  â”‚
â”‚ /forecast/sensor1                â”‚ â—„â”€â”€â”€ Prediction: 35.42 mm
â”‚   {pred_10min: 35.42, ...}       â”‚
â”‚                                  â”‚
â”‚ /config/sensor1                  â”‚ â—„â”€â”€â”€ Remote config
â”‚   {sensorHeight: 50, ...}        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²         â–²          â–²
         â”‚         â”‚          â”‚
    (read)    (read)    (write)

LAYER 3: DATA PROCESSING (Scripts)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   main.py        â”‚    â”‚ml_forecast_weather   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Fetch Firebase â”‚    â”‚ â€¢ Read CSV history   â”‚
â”‚ â€¢ Validate data  â”‚    â”‚ â€¢ Train ML model     â”‚
â”‚ â€¢ Store in CSV   â”‚ â—„â”€â”€â”¤ â€¢ Fetch weather API  â”‚
â”‚ â€¢ Append records â”‚    â”‚ â€¢ Predict future     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Push to Firebase   â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚
         â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   history.csv (Local Storage)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ distance,waterLevel,timestamp    â”‚
â”‚ 15.23,34.77,1700400000000        â”‚
â”‚ 15.45,34.55,1700400005000        â”‚
â”‚ 15.10,34.90,1700400010000        â”‚
â”‚ ... (120+ records)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 4: BACKEND API (Flask)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Flask Backend (app.py)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Routes:                              â”‚
â”‚ âœ“ GET /api/water-status              â”‚
â”‚   â””â”€ Returns {sensor, forecast, ...} â”‚
â”‚                                      â”‚
â”‚ âœ“ POST /chat                         â”‚
â”‚   â””â”€ AI with water context           â”‚
â”‚                                      â”‚
â”‚ Functions:                           â”‚
â”‚ â€¢ get_latest_sensor_data()           â”‚
â”‚ â€¢ get_forecast_data()                â”‚
â”‚ â€¢ get_history_stats()                â”‚
â”‚ â€¢ build_water_context()              â”‚
â”‚ â€¢ OpenAI integration                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â–²
         â”‚              â”‚
         â–¼              â”‚
    (serves)    (calls API)

LAYER 5: FRONTEND (Web UI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ai-assistant.html (Responsive Web)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                     â”‚ ğŸ’§ Má»±c NÆ°á»›c  â”‚ â”‚
â”‚ â”‚   Chat Interface    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚                     â”‚ â—† 34.77 mm   â”‚ â”‚
â”‚ â”‚ User: "NÆ°á»›c         â”‚ (ğŸŸ¢ Normal)  â”‚ â”‚
â”‚ â”‚ bao nhiÃªu?"         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚                     â”‚ ğŸ“ˆ Forecast  â”‚ â”‚
â”‚ â”‚ AI: "34.77 mm,      â”‚ â—† 35.42 mm   â”‚ â”‚
â”‚ â”‚ bÃ¬nh thÆ°á»ng, khÃ´ng  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚ nguy hiá»ƒm"          â”‚ ğŸ“Š Min/Max   â”‚ â”‚
â”‚ â”‚                     â”‚ â—† 20/45 mm   â”‚ â”‚
â”‚ â”‚                     â”‚ â—† Avg 32 mm  â”‚ â”‚
â”‚ â”‚                     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚                     â”‚ [Cáº­p nháº­t]   â”‚ â”‚
â”‚ â”‚                     â”‚ (má»—i 5s)     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 6: AI INTELLIGENCE (OpenAI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      OpenAI GPT-4o-mini          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ System Prompt:                   â”‚
â”‚ "Báº¡n lÃ  trá»£ lÃ½ vá» lÅ© lá»¥t..."    â”‚
â”‚ "Dá»¯ liá»‡u cáº£m biáº¿n hiá»‡n táº¡i:     â”‚
â”‚  - Má»±c nÆ°á»›c: 34.77 mm"           â”‚
â”‚  - Dá»± bÃ¡o 10min: 35.42 mm"       â”‚
â”‚  - Trung bÃ¬nh: 32.45 mm"         â”‚
â”‚  - Min/Max: 20/45 mm"            â”‚
â”‚                                  â”‚
â”‚ User Message:                    â”‚
â”‚ "Má»±c nÆ°á»›c sáº½ bao nhiÃªu?"         â”‚
â”‚                                  â”‚
â”‚ Response:                        â”‚
â”‚ "Dá»± bÃ¡o 10 phÃºt tá»›i 35.42mm..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
         â”‚ (with context)
         â”‚
      (uses real data)
```

---

## Data Update Cycle (Every 5 Seconds)

```
TIME: 14:30:00
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T+0s: Arduino measures HC-SR04 distance = 15.23 cm          â”‚
â”‚       Calculates: waterLevel = 50 - 15.23 = 34.77 mm        â”‚
â”‚       Sends to Firebase                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T+1s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ main.py fetches Firebase, appends to history.csv            â”‚
â”‚ CSV now has 120+ records                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T+2s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ml_forecast_weather.py reads CSV                            â”‚
â”‚ â€¢ Trains LinearRegression model                             â”‚
â”‚ â€¢ Fetches weather (rainfall)                                â”‚
â”‚ â€¢ Predicts water level in 10 min                            â”‚
â”‚ â€¢ Result: 35.42 mm                                          â”‚
â”‚ â€¢ Pushes to Firebase                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T+3s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User opens frontend (browser)                               â”‚
â”‚ Frontend calls /api/water-status                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T+4s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend fetches:                                            â”‚
â”‚ â€¢ Sensor from Firebase (34.77 mm)                           â”‚
â”‚ â€¢ Forecast from Firebase (35.42 mm)                         â”‚
â”‚ â€¢ Stats from CSV (min, max, avg)                            â”‚
â”‚ â€¢ Returns JSON response                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T+5s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend updates Water Panel:                               â”‚
â”‚ â€¢ ğŸ’§ 34.77 mm (ğŸŸ¢ Normal)                                   â”‚
â”‚ â€¢ ğŸ“ˆ Forecast: 35.42 mm                                     â”‚
â”‚ â€¢ ğŸ“Š Avg: 32.45 mm                                          â”‚
â”‚ â€¢ Min/Max: 20.15 / 45.30 mm                                 â”‚
â”‚                                                             â”‚
â”‚ REPEAT (next update at T+10s)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## User Interaction Flow

```
USER ASKS: "Má»±c nÆ°á»›c bao nhiÃªu mm?"
â”‚
â”œâ”€â–º FRONTEND
â”‚   â€¢ User types message
â”‚   â€¢ Sends to /chat endpoint
â”‚   
â”œâ”€â–º BACKEND (app.py)
â”‚   â€¢ get_latest_sensor_data()  â”€â”€â–º Firebase: 34.77 mm
â”‚   â€¢ get_forecast_data()       â”€â”€â–º Firebase: 35.42 mm
â”‚   â€¢ get_history_stats()       â”€â”€â–º CSV: avg=32.45, min=20, max=45
â”‚   â€¢ build_water_context()
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     â”‚ **Dá»¯ liá»‡u Cáº£m Biáº¿n:**              â”‚
â”‚     â”‚ - Má»±c nÆ°á»›c: 34.77 mm                â”‚
â”‚     â”‚ - Dá»± bÃ¡o +10min: 35.42 mm           â”‚
â”‚     â”‚ - Trung bÃ¬nh: 32.45 mm              â”‚
â”‚     â”‚ - Min/Max: 20/45 mm                 â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€â–º OPENAI API
â”‚   â€¢ System prompt: [with context above]
â”‚   â€¢ User message: "Má»±c nÆ°á»›c bao nhiÃªu mm?"
â”‚   â€¢ Model: gpt-4o-mini
â”‚   
â”œâ”€â–º OPENAI RESPONSE
â”‚   "Má»±c nÆ°á»›c hiá»‡n táº¡i lÃ  34.77 mm.
â”‚    Náº±m trong má»©c bÃ¬nh thÆ°á»ng.
â”‚    Dá»± bÃ¡o trong 10 phÃºt sáº½ tÄƒng lÃªn 35.42 mm.
â”‚    Trung bÃ¬nh tá»« trÆ°á»›c: 32.45 mm."
â”‚
â”œâ”€â–º BACKEND
â”‚   â€¢ Returns JSON: {"reply": "..."}
â”‚
â””â”€â–º FRONTEND
    â€¢ Displays AI response in chat
    â€¢ Updates Water Panel simultaneously
    â€¢ User sees informed answer with real data
```

---

## Component Interaction Matrix

```
                   Arduino  Firebase  main.py  ML Script  Flask  Frontend
Arduino            â”€â”€â”€      â”€â”€â”€â”€â–º     â”€â”€â”€      â”€â”€â”€        â”€â”€â”€    â”€â”€â”€
                            sends
                            data

Firebase           â—„â”€â”€â”€â”€     â”€â”€â”€      â—„â”€â”€â”€â”€    â—„â”€â”€â”€â”€â”€â”€    â—„â”€â”€â”€   â”€â”€â”€
                  receives         reads     reads &
                                            writes

main.py            â”€â”€â”€      â—„â”€â”€â”€     â”€â”€â”€      â”€â”€â”€        â”€â”€â”€    â”€â”€â”€
                          reads

ML Script          â”€â”€â”€      â”€â”€â”€â”€â”€â”€â–º   â—„â”€â”€â”€    â”€â”€â”€        â”€â”€â”€    â”€â”€â”€
                          writes    reads

Flask              â”€â”€â”€      â—„â”€â”€â”€     â—„â”€â”€â”€    â”€â”€â”€        â”€â”€â”€    â—„â”€â”€â”€
                          reads    reads              sends

Frontend           â”€â”€â”€      â”€â”€â”€      â”€â”€â”€     â”€â”€â”€       â—„â”€â”€â”€    â”€â”€â”€
                                                       reads
                                                       data
```

---

## Data Structure Examples

### Firebase Sensor Data
```json
{
  "distance": 15.23,
  "waterLevel": 34.77,
  "timestamp": 1700400000000
}
```

### Firebase Forecast Data
```json
{
  "pred_10min": 35.42,
  "pred_30min": 36.15,
  "timestamp": 1700400010000,
  "model": "LinearRegression",
  "features": "time_series+weather"
}
```

### CSV History
```csv
distance,waterLevel,timestamp
15.23,34.77,1700400000000
15.45,34.55,1700400005000
15.10,34.90,1700400010000
```

### API Response (JSON)
```json
{
  "sensor": {
    "waterLevel": 34.77,
    "distance": 15.23,
    "timestamp": 1700400000000
  },
  "forecast": {
    "pred_10min": 35.42,
    "pred_30min": 36.15,
    "timestamp": 1700400010000
  },
  "history": {
    "current": 34.77,
    "min": 20.15,
    "max": 45.30,
    "avg": 32.45,
    "records": 120
  },
  "timestamp": "2025-11-19T14:30:00.000000"
}
```

### AI Chat Request
```json
{
  "message": "Má»±c nÆ°á»›c bao nhiÃªu mm?"
}
```

### AI Chat Response
```json
{
  "reply": "Má»±c nÆ°á»›c hiá»‡n táº¡i lÃ  34.77 mm, náº±m trong má»©c bÃ¬nh thÆ°á»ng..."
}
```

---

## System Thresholds

```
Water Level (mm)
â”‚
200 mm  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ ğŸ”´ DANGER ZONE
        â”‚ Action: DI TÃN NGAY! (Evacuate immediately!)
        â”‚
150 mm  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ ğŸŸ¡ WARNING ZONE
        â”‚ Action: Chuáº©n bá»‹, theo dÃµi gáº§n gÅ©i
        â”‚
  0 mm  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ ğŸŸ¢ SAFE ZONE
        â”‚ Action: Tiáº¿p tá»¥c theo dÃµi
        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        Time
```

---

## Error Handling Paths

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Error Occurs    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ What type of error?                   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼          â–¼
Firebase    CSV      Weather   OpenAI    Network
Error       Error     Error     Error     Error
â”‚            â”‚         â”‚         â”‚         â”‚
â”œâ”€ Log       â”œâ”€ Log   â”œâ”€ Log   â”œâ”€ Log   â”œâ”€ Log
â”œâ”€ Retry    â”œâ”€ Skip  â”œâ”€ Skip  â”œâ”€ Warn  â”œâ”€ Warn
â”œâ”€ Use      â”œâ”€ Empty â”œâ”€ Defaultâ”‚â”€ Fallback
â”‚ Cache     â””â”€ Continue
â””â”€ Continue
```

---

## Performance Metrics

```
Component              Time    Frequency   Impact
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Arduino Measure       ~50ms    Every 5s   High
Firebase Fetch        1-2s     Various    Medium
CSV Read              ~50ms    Every 5s   Low
ML Training           ~10ms    Every 5s   Low
ML Prediction         ~5ms     Every 5s   Medium
OpenAI API           1-3s     On demand  High
Frontend Render       <20ms    Every 5s   Low
API Response          <100ms   On demand  Medium

Total Pipeline Latency: ~3-5 seconds (limited by OpenAI)
```

---

## Deployment Architecture (Future)

```
Cloud Deployment (Optional)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Hosting Platform                â”‚
â”‚  (Heroku, AWS, Google Cloud, etc.)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   Docker Container / VM Instance   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚                                    â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚  â”‚   Flask + Python Environment â”‚ â”‚ â”‚
â”‚ â”‚  â”‚   â€¢ app.py                   â”‚ â”‚ â”‚
â”‚ â”‚  â”‚   â€¢ main.py (cron job)       â”‚ â”‚ â”‚
â”‚ â”‚  â”‚   â€¢ ml_forecast_weather.py   â”‚ â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                    â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚  â”‚   Frontend (Static Files)    â”‚ â”‚ â”‚
â”‚ â”‚  â”‚   â€¢ HTML, CSS, JS            â”‚ â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²              â–²              â–²
        â”‚              â”‚              â”‚
   Firebase        OpenAI         Weather
   Database         API           API
```

---

**Diagram Created:** November 19, 2025  
**Version:** 1.0
