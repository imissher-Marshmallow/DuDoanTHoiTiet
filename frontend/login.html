<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Nhập - Cảnh Báo Lũ Lụt</title>
    <link rel="stylesheet" href="auth.css">
</head>
<body>
    <div class="auth-container">
        <h2>Đăng Nhập - FloodSense</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email hoặc Số điện thoại</label>
                <input type="text" id="email" placeholder="Nhập email hoặc số điện thoại" required>
            </div>
            <div class="form-group">
                <label for="password">Mật khẩu</label>
                <input type="password" id="password" placeholder="Nhập mật khẩu" required>
            </div>
            <button type="submit" class="btn-primary">Đăng Nhập</button>
        </form>
        <div class="auth-link">
            Chưa có tài khoản? <a href="register.html">Đăng ký ngay</a>
        </div>
    </div>

    <script>
    document.getElementById("loginForm").addEventListener("submit", function(e) {
        e.preventDefault();

        const emailOrPhone = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        // Validate input
        if (!emailOrPhone || !password) {
            alert("⚠️ Vui lòng điền đầy đủ thông tin!");
            return;
        }

        // Get users from localStorage
        let users = JSON.parse(localStorage.getItem("users")) || [];
        
        // Find matching user
        let foundUser = users.find(u => 
            (u.email === emailOrPhone || u.phone === emailOrPhone) && u.password === password
        );

        if (foundUser) {
            // Store current user session
            localStorage.setItem("currentUser", JSON.stringify({
                email: foundUser.email,
                phone: foundUser.phone,
                name: foundUser.name,
                loginTime: new Date().toISOString()
            }));
            
            console.log("✓ Đăng nhập thành công:", foundUser.email || foundUser.phone);
            alert("✓ Đăng nhập thành công!");
            
            // Redirect to dashboard
            window.location.href = "index.html";
        } else {
            console.warn("❌ Sai thông tin đăng nhập");
            alert("❌ Sai email/điện thoại hoặc mật khẩu!");
        }
    });

    // Check if already logged in
    window.addEventListener("DOMContentLoaded", function() {
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (currentUser) {
            console.log("User already logged in:", currentUser.email);
            // Optionally redirect to dashboard if already logged in
            // window.location.href = "index.html";
        }
    });
    </script>
</body>
</html>